!function(){class e{constructor(){this.pluginCallbacks=[],this.register(function(e){return new h(e)}),this.register(function(e){return new c(e)}),this.register(function(e){return new f(e)}),this.register(function(e){return new $(e)}),this.register(function(e){return new p(e)}),this.register(function(e){return new m(e)})}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,i){let r=new u,n=[];for(let a=0,o=this.pluginCallbacks.length;a<o;a++)n.push(this.pluginCallbacks[a](r));r.setPlugins(n),r.write(e,t,i).catch(s)}parseAsync(e,t){let s=this;return new Promise(function(i,r){s.parse(e,i,r,t)})}}let t={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},s={};s[THREE.NearestFilter]=t.NEAREST,s[THREE.NearestMipmapNearestFilter]=t.NEAREST_MIPMAP_NEAREST,s[THREE.NearestMipmapLinearFilter]=t.NEAREST_MIPMAP_LINEAR,s[THREE.LinearFilter]=t.LINEAR,s[THREE.LinearMipmapNearestFilter]=t.LINEAR_MIPMAP_NEAREST,s[THREE.LinearMipmapLinearFilter]=t.LINEAR_MIPMAP_LINEAR,s[THREE.ClampToEdgeWrapping]=t.CLAMP_TO_EDGE,s[THREE.RepeatWrapping]=t.REPEAT,s[THREE.MirroredRepeatWrapping]=t.MIRRORED_REPEAT;let i={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function r(e,t){return e.length===t.length&&e.every(function(e,s){return e===t[s]})}function n(e){return 4*Math.ceil(e/4)}function a(e,t=0){let s=n(e.byteLength);if(s!==e.byteLength){let i=new Uint8Array(s);if(i.set(new Uint8Array(e)),0!==t)for(let r=e.byteLength;r<s;r++)i[r]=t;return i.buffer}return e}function o(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function l(e,t){if(void 0!==e.toBlob)return new Promise(s=>e.toBlob(s,t));let s;return"image/jpeg"===t?s=.92:"image/webp"===t&&(s=.8),e.convertToBlob({type:t,quality:s})}class u{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,s){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);let i=this.buffers,r=this.json;s=this.options;let n=this.extensionsUsed,o=new Blob(i,{type:"application/octet-stream"}),l=Object.keys(n);if(l.length>0&&(r.extensionsUsed=l),r.buffers&&r.buffers.length>0&&(r.buffers[0].byteLength=o.size),!0===s.binary){let u=new FileReader;u.readAsArrayBuffer(o),u.onloadend=function(){var e;let s=a(u.result),i=new DataView(new ArrayBuffer(8));i.setUint32(0,s.byteLength,!0),i.setUint32(4,5130562,!0);let n=a((e=JSON.stringify(r),new TextEncoder().encode(e).buffer),32),o=new DataView(new ArrayBuffer(8));o.setUint32(0,n.byteLength,!0),o.setUint32(4,1313821514,!0);let l=new ArrayBuffer(12),h=new DataView(l);h.setUint32(0,1179937895,!0),h.setUint32(4,2,!0);let c=12+o.byteLength+n.byteLength+i.byteLength+s.byteLength;h.setUint32(8,c,!0);let p=new Blob([l,o,n,i,s],{type:"application/octet-stream"}),m=new FileReader;m.readAsArrayBuffer(p),m.onloadend=function(){t(m.result)}}}else if(r.buffers&&r.buffers.length>0){let h=new FileReader;h.readAsDataURL(o),h.onloadend=function(){let e=h.result;r.buffers[0].uri=e,t(r)}}else t(r)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;let s=this.options,i=this.extensionsUsed;try{let r=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&r.gltfExtensions){for(let n in void 0===t.extensions&&(t.extensions={}),r.gltfExtensions)t.extensions[n]=r.gltfExtensions[n],i[n]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(a){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+a.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){let s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}let i=this.uids.get(e);return i.get(t)}isNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return!1;let s=new THREE.Vector3;for(let i=0,r=e.count;i<r;i++)if(Math.abs(s.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);let s=e.clone(),i=new THREE.Vector3;for(let r=0,n=s.count;r<n;r++)i.fromBufferAttribute(s,r),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),s.setXYZ(r,i.x,i.y,i.z);return t.attributesNormalized.set(e,s),s}applyTextureTransform(e,t){let s=!1,i={};(0!==t.offset.x||0!==t.offset.y)&&(i.offset=t.offset.toArray(),s=!0),0!==t.rotation&&(i.rotation=t.rotation,s=!0),(1!==t.repeat.x||1!==t.repeat.y)&&(i.scale=t.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function s(e){return e.encoding===THREE.sRGBEncoding?function e(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}:function e(t){return t}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");let i=e?.image,r=t?.image,n=Math.max(i?.width||0,r?.width||0),a=Math.max(i?.height||0,r?.height||0),l=o();l.width=n,l.height=a;let u=l.getContext("2d");u.fillStyle="#00ffff",u.fillRect(0,0,n,a);let h=u.getImageData(0,0,n,a);if(i){u.drawImage(i,0,0,n,a);let c=s(e),p=u.getImageData(0,0,n,a).data;for(let m=2;m<p.length;m+=4)h.data[m]=256*c(p[m]/256)}if(r){u.drawImage(r,0,0,n,a);let f=s(t),$=u.getImageData(0,0,n,a).data;for(let g=1;g<$.length;g+=4)h.data[g]=256*f($[g]/256)}u.putImageData(h,0,0);let d=(e||t).clone();return d.source=new THREE.Source(l),d.encoding=THREE.LinearEncoding,d}processBuffer(e){let t=this.json,s=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,s,i,r,a){let o=this.json;o.bufferViews||(o.bufferViews=[]);let l;l=s===t.UNSIGNED_BYTE?1:s===t.UNSIGNED_SHORT?2:4;let u=n(r*e.itemSize*l),h=new DataView(new ArrayBuffer(u)),c=0;for(let p=i;p<i+r;p++)for(let m=0;m<e.itemSize;m++){let f;e.itemSize>4?f=e.array[p*e.itemSize+m]:0===m?f=e.getX(p):1===m?f=e.getY(p):2===m?f=e.getZ(p):3===m&&(f=e.getW(p)),s===t.FLOAT?h.setFloat32(c,f,!0):s===t.UNSIGNED_INT?h.setUint32(c,f,!0):s===t.UNSIGNED_SHORT?h.setUint16(c,f,!0):s===t.UNSIGNED_BYTE&&h.setUint8(c,f),c+=l}let $={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:u};void 0!==a&&($.target=a),a===t.ARRAY_BUFFER&&($.byteStride=e.itemSize*l),this.byteOffset+=u,o.bufferViews.push($);let g={id:o.bufferViews.length-1,byteLength:0};return g}processBufferViewImage(e){let t=this,s=t.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(i){let r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){let e=a(r.result),n={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,i(s.bufferViews.push(n)-1)}})}processAccessor(e,s,i,r){let n=this.json,a;if(e.array.constructor===Float32Array)a=t.FLOAT;else if(e.array.constructor===Uint32Array)a=t.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)a=t.UNSIGNED_SHORT;else if(e.array.constructor===Uint8Array)a=t.UNSIGNED_BYTE;else throw Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");if(void 0===i&&(i=0),void 0===r&&(r=e.count),0===r)return null;let o=function e(t,s,i){let r={min:Array(t.itemSize).fill(Number.POSITIVE_INFINITY),max:Array(t.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=s;n<s+i;n++)for(let a=0;a<t.itemSize;a++){let o;t.itemSize>4?o=t.array[n*t.itemSize+a]:0===a?o=t.getX(n):1===a?o=t.getY(n):2===a?o=t.getZ(n):3===a&&(o=t.getW(n)),r.min[a]=Math.min(r.min[a],o),r.max[a]=Math.max(r.max[a],o)}return r}(e,i,r),l;void 0!==s&&(l=e===s.index?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER);let u=this.processBufferView(e,a,i,r,l),h={bufferView:u.id,byteOffset:u.byteOffset,componentType:a,count:r,max:o.max,min:o.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(h.normalized=!0),n.accessors||(n.accessors=[]),n.accessors.push(h)-1}processImage(e,t,s,i="image/png"){let r=this,n=r.cache,a=r.json,u=r.options,h=r.pending;n.images.has(e)||n.images.set(e,{});let c=n.images.get(e),p=i+":flipY/"+s.toString();if(void 0!==c[p])return c[p];a.images||(a.images=[]);let m={mimeType:i},f=o();f.width=Math.min(e.width,u.maxTextureSize),f.height=Math.min(e.height,u.maxTextureSize);let $=f.getContext("2d");if(!0===s&&($.translate(0,f.height),$.scale(1,-1)),void 0!==e.data){t!==THREE.RGBAFormat&&console.error("GLTFExporter: Only THREE.RGBAFormat is supported."),(e.width>u.maxTextureSize||e.height>u.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);let g=new Uint8ClampedArray(e.height*e.width*4);for(let d=0;d<g.length;d+=4)g[d+0]=e.data[d+0],g[d+1]=e.data[d+1],g[d+2]=e.data[d+2],g[d+3]=e.data[d+3];$.putImageData(new ImageData(g,e.width,e.height),0,0)}else $.drawImage(e,0,0,f.width,f.height);!0===u.binary?h.push(l(f,i).then(e=>r.processBufferViewImage(e)).then(e=>{m.bufferView=e})):void 0!==f.toDataURL?m.uri=f.toDataURL(i):h.push(l(f,i).then(e=>new FileReader().readAsDataURL(e)).then(e=>{m.uri=e}));let x=a.images.push(m)-1;return c[p]=x,x}processSampler(e){let t=this.json;t.samplers||(t.samplers=[]);let i={magFilter:s[e.magFilter],minFilter:s[e.minFilter],wrapS:s[e.wrapS],wrapT:s[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){let t=this.cache,s=this.json;if(t.textures.has(e))return t.textures.get(e);s.textures||(s.textures=[]);let i=e.userData.mimeType;"image/webp"===i&&(i="image/png");let r={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,i)};e.name&&(r.name=e.name),this._invokeAll(function(t){t.writeTexture&&t.writeTexture(e,r)});let n=s.textures.push(r)-1;return t.textures.set(e,n),n}processMaterial(e){let t=this.cache,s=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);let i={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");let n=e.color.toArray().concat([e.opacity]);if(r(n,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=n),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){let a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),o={index:this.processTexture(a)};this.applyTextureTransform(o,a),i.pbrMetallicRoughness.metallicRoughnessTexture=o}if(e.map){let l={index:this.processTexture(e.map)};this.applyTextureTransform(l,e.map),i.pbrMetallicRoughness.baseColorTexture=l}if(e.emissive){let u=e.emissive.clone().multiplyScalar(e.emissiveIntensity),h=Math.max(u.r,u.g,u.b);if(h>1&&(u.multiplyScalar(1/h),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),h>0&&(i.emissiveFactor=u.toArray()),e.emissiveMap){let c={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(c,e.emissiveMap),i.emissiveTexture=c}}if(e.normalMap){let p={index:this.processTexture(e.normalMap)};e.normalScale&&1!==e.normalScale.x&&(p.scale=e.normalScale.x),this.applyTextureTransform(p,e.normalMap),i.normalTexture=p}if(e.aoMap){let m={index:this.processTexture(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(m.strength=e.aoMapIntensity),this.applyTextureTransform(m,e.aoMap),i.occlusionTexture=m}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===THREE.DoubleSide&&(i.doubleSided=!0),""!==e.name&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll(function(t){t.writeMaterial&&t.writeMaterial(e,i)});let f=s.materials.push(i)-1;return t.materials.set(e,f),f}processMesh(e){let s=this.cache,i=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let n=0,a=e.material.length;n<a;n++)r.push(e.material[n].uuid);else r.push(e.material.uuid);let o=r.join(":");if(s.meshes.has(o))return s.meshes.get(o);let l=e.geometry,u;u=e.isLineSegments?t.LINES:e.isLineLoop?t.LINE_LOOP:e.isLine?t.LINE_STRIP:e.isPoints?t.POINTS:e.material.wireframe?t.LINES:t.TRIANGLES;let h={},c={},p=[],m=[],f={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},$=l.getAttribute("normal");void 0===$||this.isNormalizedNormalAttribute($)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),l.setAttribute("normal",this.createNormalizedNormalAttribute($)));let g=null;for(let d in l.attributes){if("morph"===d.slice(0,5))continue;let x=l.attributes[d];d=f[d]||d.toUpperCase();let T=/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/;if(T.test(d)||(d="_"+d),s.attributes.has(this.getUID(x))){c[d]=s.attributes.get(this.getUID(x));continue}g=null;let E=x.array;"JOINTS_0"!==d||E instanceof Uint16Array||E instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new THREE.BufferAttribute(new Uint16Array(E),x.itemSize,x.normalized));let b=this.processAccessor(g||x,l);null!==b&&(c[d]=b,s.attributes.set(this.getUID(x),b))}if(void 0!==$&&l.setAttribute("normal",$),0===Object.keys(c).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){let y=[],M=[],w={};if(void 0!==e.morphTargetDictionary)for(let I in e.morphTargetDictionary)w[e.morphTargetDictionary[I]]=I;for(let R=0;R<e.morphTargetInfluences.length;++R){let A={},N=!1;for(let _ in l.morphAttributes){if("position"!==_&&"normal"!==_){N||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),N=!0);continue}let S=l.morphAttributes[_][R],L=_.toUpperCase(),v=l.attributes[_];if(s.attributes.has(this.getUID(S,!0))){A[L]=s.attributes.get(this.getUID(S,!0));continue}let F=S.clone();if(!l.morphTargetsRelative)for(let U=0,k=S.count;U<k;U++)F.setXYZ(U,S.getX(U)-v.getX(U),S.getY(U)-v.getY(U),S.getZ(U)-v.getZ(U));A[L]=this.processAccessor(F,l),s.attributes.set(this.getUID(v,!0),A[L])}m.push(A),y.push(e.morphTargetInfluences[R]),void 0!==e.morphTargetDictionary&&M.push(w[R])}h.weights=y,M.length>0&&(h.extras={},h.extras.targetNames=M)}let D=Array.isArray(e.material);if(D&&0===l.groups.length)return null;let O=D?e.material:[e.material],P=D?l.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let z=0,B=P.length;z<B;z++){let C={mode:u,attributes:c};if(this.serializeUserData(l,C),m.length>0&&(C.targets=m),null!==l.index){let G=this.getUID(l.index);(void 0!==P[z].start||void 0!==P[z].count)&&(G+=":"+P[z].start+":"+P[z].count),s.attributes.has(G)?C.indices=s.attributes.get(G):(C.indices=this.processAccessor(l.index,l,P[z].start,P[z].count),s.attributes.set(G,C.indices)),null===C.indices&&delete C.indices}let H=this.processMaterial(O[P[z].materialIndex]);null!==H&&(C.material=H),p.push(C)}h.primitives=p,i.meshes||(i.meshes=[]),this._invokeAll(function(t){t.writeMesh&&t.writeMesh(e,h)});let V=i.meshes.push(h)-1;return s.meshes.set(o,V),V}processCamera(e){let t=this.json;t.cameras||(t.cameras=[]);let s=e.isOrthographicCamera,i={type:s?"orthographic":"perspective"};return s?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:THREE.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(t,s){let r=this.json,n=this.nodeMap;r.animations||(r.animations=[]),t=e.Utils.mergeMorphTargetTracks(t.clone(),s);let a=t.tracks,o=[],l=[];for(let u=0;u<a.length;++u){let h=a[u],c=THREE.PropertyBinding.parseTrackName(h.name),p=THREE.PropertyBinding.findNode(s,c.nodeName),m=i[c.propertyName];if("bones"===c.objectName&&(p=!0===p.isSkinnedMesh?p.skeleton.getBoneByName(c.objectIndex):void 0),!p||!m)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',h.name),null;let f=h.values.length/h.times.length;m===i.morphTargetInfluences&&(f/=p.morphTargetInfluences.length);let $;!0===h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?($="CUBICSPLINE",f/=3):$=h.getInterpolation()===THREE.InterpolateDiscrete?"STEP":"LINEAR",l.push({input:this.processAccessor(new THREE.BufferAttribute(h.times,1)),output:this.processAccessor(new THREE.BufferAttribute(h.values,f)),interpolation:$}),o.push({sampler:l.length-1,target:{node:n.get(p),path:m}})}return r.animations.push({name:t.name||"clip_"+r.animations.length,samplers:l,channels:o}),r.animations.length-1}processSkin(e){let t=this.json,s=this.nodeMap,i=t.nodes[s.get(e)],r=e.skeleton;if(void 0===r)return null;let n=e.skeleton.bones[0];if(void 0===n)return null;let a=[],o=new Float32Array(16*r.bones.length),l=new THREE.Matrix4;for(let u=0;u<r.bones.length;++u)a.push(s.get(r.bones[u])),l.copy(r.boneInverses[u]),l.multiply(e.bindMatrix).toArray(o,16*u);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new THREE.BufferAttribute(o,16)),joints:a,skeleton:s.get(n)});let h=i.skin=t.skins.length-1;return h}processNode(e){let t=this.json,s=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);let n={};if(s.trs){let a=e.quaternion.toArray(),o=e.position.toArray(),l=e.scale.toArray();r(a,[0,0,0,1])||(n.rotation=a),r(o,[0,0,0])||(n.translation=o),r(l,[1,1,1])||(n.scale=l)}else{var u;e.matrixAutoUpdate&&e.updateMatrix(),!1===r((u=e.matrix).elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(n.matrix=e.matrix.elements)}if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){let h=this.processMesh(e);null!==h&&(n.mesh=h)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){let c=[];for(let p=0,m=e.children.length;p<m;p++){let f=e.children[p];if(f.visible||!1===s.onlyVisible){let $=this.processNode(f);null!==$&&c.push($)}}c.length>0&&(n.children=c)}this._invokeAll(function(t){t.writeNode&&t.writeNode(e,n)});let g=t.nodes.push(n)-1;return i.set(e,g),g}processScene(e){let t=this.json,s=this.options;t.scenes||(t.scenes=[],t.scene=0);let i={};""!==e.name&&(i.name=e.name),t.scenes.push(i);let r=[];for(let n=0,a=e.children.length;n<a;n++){let o=e.children[n];if(o.visible||!1===s.onlyVisible){let l=this.processNode(o);null!==l&&r.push(l)}}r.length>0&&(i.nodes=r),this.serializeUserData(e,i)}processObjects(e){let t=new THREE.Scene;t.name="AuxScene";for(let s=0;s<e.length;s++)t.children.push(e[s]);this.processScene(t)}processInput(e){let t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(t){t.beforeParse&&t.beforeParse(e)});let s=[];for(let i=0;i<e.length;i++)e[i]instanceof THREE.Scene?this.processScene(e[i]):s.push(e[i]);s.length>0&&this.processObjects(s);for(let r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll(function(t){t.afterParse&&t.afterParse(e)})}_invokeAll(e){for(let t=0,s=this.plugins.length;t<s;t++)e(this.plugins[t])}}class h{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}let s=this.writer,i=s.json,r=s.extensionsUsed,n={};e.name&&(n.name=e.name),n.color=e.color.toArray(),n.intensity=e.intensity,e.isDirectionalLight?n.type="directional":e.isPointLight?(n.type="point",e.distance>0&&(n.range=e.distance)):e.isSpotLight&&(n.type="spot",e.distance>0&&(n.range=e.distance),n.spot={},n.spot.innerConeAngle=-((e.penumbra-1)*e.angle*1),n.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||0!==e.target.position.x||0!==e.target.position.y||-1!==e.target.position.z)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},r[this.name]=!0);let a=i.extensions[this.name].lights;a.push(n),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class c{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;let s=this.writer,i=s.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class p{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;let s=this.writer,i=s.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){let n={index:s.processTexture(e.clearcoatMap)};s.applyTextureTransform(n,e.clearcoatMap),r.clearcoatTexture=n}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){let a={index:s.processTexture(e.clearcoatRoughnessMap)};s.applyTextureTransform(a,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=a}if(e.clearcoatNormalMap){let o={index:s.processTexture(e.clearcoatNormalMap)};s.applyTextureTransform(o,e.clearcoatNormalMap),r.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class m{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;let s=this.writer,i=s.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){let n={index:s.processTexture(e.iridescenceMap)};s.applyTextureTransform(n,e.iridescenceMap),r.iridescenceTexture=n}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){let a={index:s.processTexture(e.iridescenceThicknessMap)};s.applyTextureTransform(a,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class f{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let s=this.writer,i=s.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){let n={index:s.processTexture(e.transmissionMap)};s.applyTextureTransform(n,e.transmissionMap),r.transmissionTexture=n}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class ${constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let s=this.writer,i=s.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){let n={index:s.processTexture(e.thicknessMap)};s.applyTextureTransform(n,e.thicknessMap),r.thicknessTexture=n}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}e.Utils={insertKeyframe:function(e,t){let s=e.getValueSize(),i=new e.TimeBufferType(e.times.length+1),r=new e.ValueBufferType(e.values.length+s),n=e.createInterpolant(new e.ValueBufferType(s)),a;if(0===e.times.length){i[0]=t;for(let o=0;o<s;o++)r[o]=0;a=0}else if(t<e.times[0]){if(.001>Math.abs(e.times[0]-t))return 0;i[0]=t,i.set(e.times,1),r.set(n.evaluate(t),0),r.set(e.values,s),a=0}else if(t>e.times[e.times.length-1]){if(.001>Math.abs(e.times[e.times.length-1]-t))return e.times.length-1;i[i.length-1]=t,i.set(e.times,0),r.set(e.values,0),r.set(n.evaluate(t),e.values.length),a=i.length-1}else for(let l=0;l<e.times.length;l++){if(.001>Math.abs(e.times[l]-t))return l;if(e.times[l]<t&&e.times[l+1]>t){i.set(e.times.slice(0,l+1),0),i[l+1]=t,i.set(e.times.slice(l+1),l+2),r.set(e.values.slice(0,(l+1)*s),0),r.set(n.evaluate(t),(l+1)*s),r.set(e.values.slice((l+1)*s),(l+2)*s),a=l+1;break}}return e.times=i,e.values=r,a},mergeMorphTargetTracks:function(e,t){let s=[],i={},r=e.tracks;for(let n=0;n<r.length;++n){let a=r[n],o=THREE.PropertyBinding.parseTrackName(a.name),l=THREE.PropertyBinding.findNode(t,o.nodeName);if("morphTargetInfluences"!==o.propertyName||void 0===o.propertyIndex){s.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(a=a.clone()).setInterpolation(THREE.InterpolateLinear)}let u=l.morphTargetInfluences.length,h=l.morphTargetDictionary[o.propertyIndex];if(void 0===h)throw Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);let c;if(void 0===i[l.uuid]){c=a.clone();let p=new c.ValueBufferType(u*c.times.length);for(let m=0;m<c.times.length;m++)p[m*u+h]=c.values[m];c.name=(o.nodeName||"")+".morphTargetInfluences",c.values=p,i[l.uuid]=c,s.push(c);continue}let f=a.createInterpolant(new a.ValueBufferType(1));c=i[l.uuid];for(let $=0;$<c.times.length;$++)c.values[$*u+h]=f.evaluate(c.times[$]);for(let g=0;g<a.times.length;g++){let d=this.insertKeyframe(c,a.times[g]);c.values[d*u+h]=a.values[g]}}return e.tracks=s,e}},THREE.GLTFExporter=e}();